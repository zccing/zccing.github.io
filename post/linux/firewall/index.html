<!doctype html><html lang=zh-cn>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<title>iptbales学习笔记 - 新生代搬运工</title>
<meta name=renderer content="webkit">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<meta http-equiv=cache-control content="no-transform">
<meta http-equiv=cache-control content="no-siteapp">
<meta name=theme-color content="#f8f5ec">
<meta name=msapplication-navbutton-color content="#f8f5ec">
<meta name=apple-mobile-web-app-capable content="yes">
<meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec">
<meta name=author content="cc"><meta name=description content="本文介绍了通过iptables来配置linux防火墙,最新的centos8 已经不适用此文档"><meta name=keywords content="linux防火墙,linux firewall,centos防火墙">
<meta name=generator content="Hugo 0.88.1 with theme even">
<link rel=canonical href=https://www.net-cc.com/post/linux/firewall/>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=manifest href=/manifest.json>
<link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5>
<link href=/sass/main.min.b5a744db6de49a86cadafb3b70f555ab443f83c307a483402259e94726b045ff.css rel=stylesheet>
<link href=/lib/fancybox/jquery.fancybox-3.1.20.min.css rel=stylesheet>
<meta property="og:title" content="iptbales学习笔记">
<meta property="og:description" content="本文介绍了通过iptables来配置linux防火墙,最新的centos8 已经不适用此文档">
<meta property="og:type" content="article">
<meta property="og:url" content="https://www.net-cc.com/post/linux/firewall/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2020-08-30T01:37:56+08:00">
<meta property="article:modified_time" content="2021-09-07T21:37:59+08:00">
<meta itemprop=name content="iptbales学习笔记">
<meta itemprop=description content="本文介绍了通过iptables来配置linux防火墙,最新的centos8 已经不适用此文档"><meta itemprop=datePublished content="2020-08-30T01:37:56+08:00">
<meta itemprop=dateModified content="2021-09-07T21:37:59+08:00">
<meta itemprop=wordCount content="2957">
<meta itemprop=keywords content="linux,"><meta name=twitter:card content="summary">
<meta name=twitter:title content="iptbales学习笔记">
<meta name=twitter:description content="本文介绍了通过iptables来配置linux防火墙,最新的centos8 已经不适用此文档"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]-->
</head>
<body>
<div id=mobile-navbar class=mobile-navbar>
<div class=mobile-header-logo>
<a href=/ class=logo>新生代搬运工</a>
</div>
<div class=mobile-navbar-icon>
<span></span>
<span></span>
<span></span>
</div>
</div>
<nav id=mobile-menu class="mobile-menu slideout-menu">
<ul class=mobile-menu-list>
<a href=/>
<li class=mobile-menu-item>主页</li>
</a><a href=/post/>
<li class=mobile-menu-item>归档</li>
</a><a href=/tags/>
<li class=mobile-menu-item>标签</li>
</a><a href=/categories/>
<li class=mobile-menu-item>类别</li>
</a><a href=/about/>
<li class=mobile-menu-item>关于</li>
</a>
</ul>
</nav>
<div class=container id=mobile-panel>
<header id=header class=header>
<div class=logo-wrapper>
<a href=/ class=logo>新生代搬运工</a>
</div>
<nav class=site-navbar>
<ul id=menu class=menu>
<li class=menu-item>
<a class=menu-item-link href=/>主页</a>
</li><li class=menu-item>
<a class=menu-item-link href=/post/>归档</a>
</li><li class=menu-item>
<a class=menu-item-link href=/tags/>标签</a>
</li><li class=menu-item>
<a class=menu-item-link href=/categories/>类别</a>
</li><li class=menu-item>
<a class=menu-item-link href=/about/>关于</a>
</li>
</ul>
</nav>
</header>
<main id=main class=main>
<div class=content-wrapper>
<div id=content class=content>
<article class=post>
<header class=post-header>
<h1 class=post-title>iptbales学习笔记</h1>
<div class=post-meta>
<span class=post-time> 2020年08月30日 </span>
<div class=post-category>
<a href=/categories/linux/> linux </a>
</div>
<span class=more-meta> 约 2957 字 </span>
<span class=more-meta> 预计阅读 6 分钟 </span>
</div>
</header>
<div class=post-toc id=post-toc>
<h2 class=post-toc-title>文章目录</h2>
<div class="post-toc-content always-active">
<nav id=TableOfContents>
<ul>
<li><a href=#iptbales配置>iptbales配置</a>
<ul>
<li><a href=#iptables介绍>iptables介绍</a>
<ul>
<li><a href=#iptables命令>iptables命令</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</div>
</div>
<div class=post-content>
<p>本文介绍了通过iptables来配置linux防火墙,最新的centos8 已经不适用此文档</p>
<h1 id=iptbales配置>iptbales配置</h1>
<h2 id=iptables介绍>iptables介绍</h2>
<blockquote>
<p>包过滤型的防火墙，隔离工具；工作于主机或网络边缘，对于进出本主机或本网络的报文根据事先定义的检查规则作匹配检测，对于能够被规则匹配到的报文作出相应处理的组件；
<code>iptables</code> 的底层是用内核的<code>netfilter</code> 来进行包过滤的</p>
</blockquote>
<ul>
<li>
<p><code>netfilter hook function</code>:</p>
<ul>
<li><code>prerouting</code></li>
<li><code>input</code></li>
<li><code>output</code></li>
<li><code>forward</code></li>
<li><code>postrouting</code></li>
</ul>
</li>
<li>
<p>链（内置）：<code>PREROUTING</code>、<code>INPUT</code>、<code>FORWARD</code>、<code>INPUT</code>、<code>POSTROUTING</code></p>
</li>
<li>
<p>功能：</p>
<ul>
<li><code>filter</code>：过滤，防火墙；</li>
<li><code>nat</code>: <code>network address translation</code>；用于修改源IP或目标IP，也可以改端口；</li>
<li><code>mangle</code>: 拆解报文，做出修改，并重新封装起来；</li>
<li><code>raw</code>: 关闭nat表上启用的连接追踪机制；</li>
</ul>
</li>
<li>
<p>功能&lt;&ndash;链：</p>
<ul>
<li><code>raw</code>：<code>PREROUTING</code>， <code>OUTPUT</code></li>
<li><code>mangle</code>：<code>PREROUTING</code>，<code>INPUT</code>，<code>FORWARD</code>，<code>OUTPUT</code>，<code>POSTROUTING</code></li>
<li><code>nat</code>：<code>PREROUTING</code>，<code>[INPUT]OUTPUT</code>，<code>POSTROUTING</code></li>
<li><code>filter</code>：<code>INPUT</code>，<code>FORWARD</code>，<code>OUTPUT</code></li>
</ul>
</li>
<li>
<p>报文流向：</p>
<ul>
<li>流入本机：<code>PREROUTING</code> &ndash;> <code>INPUT</code></li>
<li>由本机流出：<code>OUTPUT</code> &ndash;> <code>POSTROUTING</code></li>
<li>转发：<code>PREROUTING</code> &ndash;> <code>FORWARD</code> &ndash;> <code>POSTROUTING</code></li>
</ul>
</li>
<li>
<p>路由功能发生的时刻：</p>
<ul>
<li>报文进入本机后：
判断目标主机是？</li>
<li>报文离开本机之前：
判断经由哪个接口送往下一站？</li>
</ul>
</li>
<li>
<p>规则</p>
<ul>
<li>组成部分：根据规则匹配条件来尝试匹配报文，一旦匹配成功，就由规则定义的处理动作作出处理；
<ul>
<li>匹配条件：
<ul>
<li>基本匹配条件：内建</li>
<li>扩展匹配条件：由扩展模块定义；</li>
</ul>
</li>
<li>处理动作：
<ul>
<li>基本处理动作：内建</li>
<li>扩展处理动作：由扩展模块定义；</li>
<li>自定义处理机制：自定义链</li>
</ul>
</li>
</ul>
</li>
<li>iptables的链：内置链和自定义链
<ul>
<li>内置链：对应于hook function</li>
<li>自定义链接：用于内置链的扩展和补充，可实现更灵活的规则管理机制；</li>
</ul>
</li>
<li>添加规则时的考量点：
<ul>
<li>要实现哪种功能：判断添加到哪个表上；</li>
<li>报文流经的路径：判断添加到哪个链上；</li>
<li>链：链上的规则次序，即为检查的次序；因此，隐含一定的应用法则：
<ul>
<li>同类规则（访问同一应用），匹配范围小的放上面；</li>
<li>不同类的规则（访问不同应用），匹配到报文频率较大的放在上面；</li>
<li>将那些可由一条规则描述的多个规则合并起来；</li>
<li>设置默认策略；</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id=iptables命令>iptables命令</h3>
<blockquote>
<p>高度模块化，由诸多扩展模块实现其检查条件或处理动作的定义；模块位置<code>/usr/lib64/xtables/</code>，
<code>IPv6</code>模块<code>libip6t_</code>开头，<code>IPv4</code>模块<code>libipt_</code>, <code>libxt_</code>开头</p>
</blockquote>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-sh data-lang=sh>iptables <span class=o>[</span>-t table<span class=o>]</span> <span class=o>{</span>-A<span class=p>|</span>-C<span class=p>|</span>-D<span class=o>}</span> chain rule-specification
iptables <span class=o>[</span>-t table<span class=o>]</span> -I chain <span class=o>[</span>rulenum<span class=o>]</span> rule-specification
iptables <span class=o>[</span>-t table<span class=o>]</span> -R chain rulenum rule-specification
iptables <span class=o>[</span>-t table<span class=o>]</span> -D chain rulenum
iptables <span class=o>[</span>-t table<span class=o>]</span> -S <span class=o>[</span>chain <span class=o>[</span>rulenum<span class=o>]]</span>
iptables <span class=o>[</span>-t table<span class=o>]</span> <span class=o>{</span>-F<span class=p>|</span>-L<span class=p>|</span>-Z<span class=o>}</span> <span class=o>[</span>chain <span class=o>[</span>rulenum<span class=o>]]</span> <span class=o>[</span>options...<span class=o>]</span>
iptables <span class=o>[</span>-t table<span class=o>]</span> -N chain
iptables <span class=o>[</span>-t table<span class=o>]</span> -X  <span class=o>[</span>chain<span class=o>]</span>
iptables <span class=o>[</span>-t table<span class=o>]</span> -P chain target
iptables <span class=o>[</span>-t table<span class=o>]</span> -E old-chain-name new-chain-name
rule-specification <span class=o>=</span> <span class=o>[</span>matches...<span class=o>]</span>  <span class=o>[</span>target<span class=o>]</span>
<span class=nv>match</span> <span class=o>=</span> -m matchname <span class=o>[</span>per-match-options<span class=o>]</span>
<span class=nv>target</span> <span class=o>=</span> -j targetname <span class=o>[</span>per-target-options<span class=o>]</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>规则格式：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-sh data-lang=sh>iptables <span class=o>[</span>-t table<span class=o>]</span> COMMAND chain <span class=o>[</span>PARAMETERS<span class=o>]</span> <span class=o>[</span>-m matchname <span class=o>[</span>per-match-options<span class=o>]]</span> -j targetname <span class=o>[</span>per-target-options<span class=o>]</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p><code>-t table</code>:
raw, mangle, nat, [filter]</p>
</li>
<li>
<p><code>COMMAND</code>:</p>
<ul>
<li>
<p>链管理:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-sh data-lang=sh>-N：new, 自定义一条新的规则链；
-X： delete，删除自定义的规则链；
    注意：仅能删除 用户自定义的 引用计数为0的 空的 链；
-P：Policy，设置默认策略；对filter表中的链而言，其默认策略有：
    ACCEPT：接受
    DROP：丢弃
    REJECT：拒绝
-E：重命名自定义链；引用计数不为0的自定义链不能够被重命名，也不能被删除；
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>规则管理:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-sh data-lang=sh>-A：append，追加；
-I：insert, 插入，要指明位置，省略时表示第一条；
-D：delete，删除；
    <span class=o>(</span>1<span class=o>)</span> 指明规则序号；
    <span class=o>(</span>2<span class=o>)</span> 指明规则本身；
-R：replace，替换指定链上的指定规则；
-F：flush，清空指定的规则链；
-Z：zero，置零；
    iptables的每条规则都有两个计数器：
        <span class=o>(</span>1<span class=o>)</span> 匹配到的报文的个数；
        <span class=o>(</span>2<span class=o>)</span> 匹配到的所有报文的大小之和；
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>查看</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-sh data-lang=sh>-L：list, 列出指定鏈上的所有规则；
-n：numberic，以数字格式显示地址和端口号；
-v：verbose，详细信息；
    -vv, -vvv
-x：exactly，显示计数器结果的精确值；
--line-numbers：显示规则的序号；
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li>
<p><code>chain</code>：</p>
<ul>
<li>内置链
PREROUTING，INPUT，FORWARD，OUTPUT，POSTROUTING</li>
<li>自定义链</li>
</ul>
</li>
<li>
<p>匹配条件：</p>
<ul>
<li>
<p>基本匹配条件(<code>PARAMETERS</code>)：</p>
<blockquote>
<p>无需加载任何模块，由iptables/netfilter自行提供；
<code>[!]</code>取反</p>
</blockquote>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=o>[</span>!<span class=o>]</span> -s, --source  address<span class=o>[</span>/mask<span class=o>][</span>,...<span class=o>]</span>：检查报文中的源IP地址是否符合此处指定的地址或范围；
<span class=o>[</span>!<span class=o>]</span> -d, --destination address<span class=o>[</span>/mask<span class=o>][</span>,...<span class=o>]</span>：检查报文中的目标IP地址是否符合此处指定的地址或范围；所有地址：0.0.0.0/0
<span class=o>[</span>!<span class=o>]</span> -p, --protocol protocol: tcp, udp, udplite, icmp, icmpv6,esp, ah, sctp, mh or  <span class=o>[</span>all<span class=o>]</span>
<span class=o>[</span>!<span class=o>]</span> -i, --in-interface name：数据报文流入的接口；只能应用于数据报文流入的环节，只能应用于PREROUTING，INPUT和FORWARD链；
<span class=o>[</span>!<span class=o>]</span> -o, --out-interface name：数据报文流出的接口；只能应用于数据报文流出的环节，只能应用于FORWARD、OUTPUT和POSTROUTING链；
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>扩展匹配(<code>matchname</code>)</p>
<ul>
<li>
<p>隐式扩展</p>
<blockquote>
<p>在使用-p选项指明了特定的协议时，无需再同时使用-m选项指明扩展模块的扩展机制；</p>
</blockquote>
<ul>
<li>
<p><code>tcp</code>:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=o>[</span>!<span class=o>]</span> --source-port, --sport port<span class=o>[</span>:port<span class=o>]</span>：匹配报文的源端口；可以是端口范围；
<span class=o>[</span>!<span class=o>]</span> --destination-port,--dport port<span class=o>[</span>:port<span class=o>]</span>：匹配报文的目标端口；可以是端口范围；
<span class=o>[</span>!<span class=o>]</span> --tcp-flags  mask  comp
        mask is the flags which we should examine,  written as a comma-separated list，例如 SYN,ACK,FIN,RST
        comp is a comma-separated list  of  flags  which must be set，例如SYN
        例如：“--tcp-flags  SYN,ACK,FIN,RST  SYN”表示，要检查的标志位为SYN,ACK,FIN,RST四个，其中SYN必须为1，余下的必须为0；
<span class=o>[</span>!<span class=o>]</span> --syn：用于匹配第一次握手，相当于”--tcp-flags  SYN,ACK,FIN,RST  SYN“；
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><code>udp</code>:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=o>[</span>!<span class=o>]</span> --source-port, --sport port<span class=o>[</span>:port<span class=o>]</span>：匹配报文的源端口；可以是端口范围；
<span class=o>[</span>!<span class=o>]</span> --destination-port,--dport port<span class=o>[</span>:port<span class=o>]</span>：匹配报文的目标端口；可以是端口范围；
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><code>icmp</code>:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=o>[</span>!<span class=o>]</span> --icmp-type <span class=o>{</span>type<span class=o>[</span>/code<span class=o>]</span><span class=p>|</span>typename<span class=o>}</span>
    echo-request：8/0
    echo-reply：0/0
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li>
<p>显式扩展</p>
<blockquote>
<p>必须使用-m选项指明要调用的扩展模块的扩展机制；</p>
</blockquote>
<ul>
<li>
<p><code>multiport</code>:</p>
<blockquote>
<p>以离散或连续的 方式定义多端口匹配条件，最多15个；</p>
</blockquote>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=o>[</span>!<span class=o>]</span> --source-ports,--sports port<span class=o>[</span>,port<span class=p>|</span>,port:port<span class=o>]</span>...：指定多个源端口；
<span class=o>[</span>!<span class=o>]</span> --destination-ports,--dports port<span class=o>[</span>,port<span class=p>|</span>,port:port<span class=o>]</span>...：指定多个目标端口；
$ sudo iptables -I INPUT  -d 172.16.0.7 -p tcp -m multiport --dports 22,80,139,445,3306 -j ACCEPT
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><code>iprange</code>:</p>
<blockquote>
<p>以连续地址块的方式来指明多IP地址匹配条件；</p>
</blockquote>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=o>[</span>!<span class=o>]</span> --src-range from<span class=o>[</span>-to<span class=o>]</span>
<span class=o>[</span>!<span class=o>]</span> --dst-range from<span class=o>[</span>-to<span class=o>]</span>
$ sudo iptables -I INPUT -d 172.16.0.7 -p tcp -m multiport --dports 22,80,139,445,3306 -m iprange --src-range 172.16.0.61-172.16.0.70 -j REJECT
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><code>time</code>:</p>
<blockquote>
<p>如果数据包到达时间/日期在给定范围内，则匹配。</p>
</blockquote>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-sh data-lang=sh>--timestart hh:mm<span class=o>[</span>:ss<span class=o>]</span>
--timestop hh:mm<span class=o>[</span>:ss<span class=o>]</span>
<span class=o>[</span>!<span class=o>]</span> --weekdays day<span class=o>[</span>,day...<span class=o>]</span>
<span class=o>[</span>!<span class=o>]</span> --monthdays day<span class=o>[</span>,day...<span class=o>]</span>
--datestart YYYY<span class=o>[</span>-MM<span class=o>[</span>-DD<span class=o>[</span>Thh<span class=o>[</span>:mm<span class=o>[</span>:ss<span class=o>]]]]]</span>
--datestop YYYY<span class=o>[</span>-MM<span class=o>[</span>-DD<span class=o>[</span>Thh<span class=o>[</span>:mm<span class=o>[</span>:ss<span class=o>]]]]]</span>
--kerneltz：使用内核配置的时区而非默认的UTC；
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><code>string</code>:</p>
<blockquote>
<p>此模块使用某种模式匹配策略来匹配给定的字符串, 只对明文编码的字符串可以匹配</p>
</blockquote>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-sh data-lang=sh>--algo <span class=o>{</span>bm<span class=p>|</span>kmp<span class=o>}</span>             <span class=c1># 检测模式</span>
<span class=o>[</span>!<span class=o>]</span> --string pattern        <span class=c1># 字符串</span>
<span class=o>[</span>!<span class=o>]</span> --hex-string pattern    <span class=c1># 字符串hex</span>
--from offset               <span class=c1># 从数据包的那里开始检测</span>
--to offset                 <span class=c1># 到数据包的那里检测结束</span>
$ sudo iptables -I OUTPUT -m string --algo bm --string <span class=s2>&#34;gay&#34;</span> -j REJECT
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><code>connlimit</code>:</p>
<blockquote>
<p>允许您限制每个客户端IP地址（或客户端地址块）到服务器的并行连接数。</p>
</blockquote>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-sh data-lang=sh>--connlimit-upto n      <span class=c1># 上限，小于等于N</span>
--connlimit-above n     <span class=c1># 下限，大于N</span>
$ sudo iptables -I INPUT -d 172.16.0.7 -p tcp --syn --dport <span class=m>22</span> -m connlimit --connlimit-above <span class=m>2</span> -j REJECT
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><code>limit</code>:</p>
<blockquote>
<p>该模块使用令牌桶过滤器以有限的速率匹配。
限制本机某tcp服务接收新请求的速率：&ndash;syn, -m limit</p>
</blockquote>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=c1># 限制每(秒|分钟|小时|天）可以生成多少个令牌</span>
--limit rate<span class=o>[</span>/second<span class=p>|</span>/minute<span class=p>|</span>/hour<span class=p>|</span>/day<span class=o>]</span>
<span class=c1># 令牌桶最大可以存放多少个令牌（一个令牌代表一个数据包）</span>
--limit-burst number
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><code>state</code>:</p>
</li>
<li></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>处理动作：</p>
<ul>
<li><code>-j targetname [per-target-options]</code>
<ul>
<li>简单<code>target</code>：
<code>ACCEPT</code>, <code>DROP</code>, <code>REJECT</code></li>
<li>扩展<code>target</code>：</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class=post-copyright>
<p class=copyright-item>
<span class=item-title>文章作者</span>
<span class=item-content>cc</span>
</p>
<p class=copyright-item>
<span class=item-title>上次更新</span>
<span class=item-content>
2021年09月07日
<a href=https://github.com/zccing/zccing.github.io/commit/c2e9e7dba7ca1f946ddb0b47b0e2581e6d5b4605 title="first commit">(c2e9e7d)</a>
</span>
</p>
<p class=copyright-item>
<span class=item-title>许可协议</span>
<span class=item-content><a rel="license noopener" href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank>CC BY-NC-ND 4.0</a></span>
</p>
</div>
<div class=post-reward>
<input type=checkbox name=reward id=reward hidden>
<label class=reward-button for=reward>赞赏支持</label>
<div class=qr-code>
<label class=qr-code-image for=reward>
<img class=image src=/qr-code/wechat-qr-code.png>
<span>微信打赏</span>
</label>
<label class=qr-code-image for=reward>
<img class=image src=/qr-code/alipay-qr-code.png>
<span>支付宝打赏</span>
</label>
</div>
</div><footer class=post-footer>
<div class=post-tags>
<a href=/tags/linux/>linux</a>
</div>
<nav class=post-nav>
<a class=prev href=/post/linux/docker-install/>
<i class="iconfont icon-left"></i>
<span class="prev-text nav-default">centos安装docker</span>
<span class="prev-text nav-mobile">上一篇</span>
</a>
<a class=next href=/post/linux/libvirt-kvm/>
<span class="next-text nav-default">KVM libvirt学习笔记</span>
<span class="next-text nav-mobile">下一篇</span>
<i class="iconfont icon-right"></i>
</a>
</nav>
</footer>
</article>
</div>
</div>
</main>
<footer id=footer class=footer>
<div class=social-links>
<a href=mailto:361276131@qq.com class="iconfont icon-email" title=email></a>
<a href=https://github.com/zccing class="iconfont icon-github" title=github></a>
<a href=https://www.net-cc.com/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a>
</div>
<div class=copyright>
<span class=power-by>
由 <a class=hexo-link href=https://gohugo.io>Hugo</a> 强力驱动
</span>
<span class=division>|</span>
<span class=theme-info>
主题 -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a>
</span>
<span class=copyright-year>
&copy;
2020-10-1 -
2021<span class=heart><i class="iconfont icon-heart"></i></span><span>cc</span>
</span>
</div>
</footer>
<div class=back-to-top id=back-to-top>
<i class="iconfont icon-up"></i>
</div>
</div>
<script type=text/javascript src=/lib/jquery/jquery-3.2.1.min.js></script>
<script type=text/javascript src=/lib/slideout/slideout-1.0.1.min.js></script>
<script type=text/javascript src=/lib/fancybox/jquery.fancybox-3.1.20.min.js></script>
<script type=text/javascript src=/lib/timeago/timeago-3.0.2.min.js></script>
<script type=text/javascript src=/lib/timeago/timeago.locales-3.0.2.min.js></script>
<script>var languageCode="zh-cn".replace(/-/g,'_').replace(/_(.*)/,function(b,a){return b.replace(a,a.toUpperCase())});timeago().render(document.querySelectorAll('.timeago'),languageCode),timeago.cancel()</script>
<script type=text/javascript src=/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js></script>
<script id=baidu_analytics>var _hmt=_hmt||[];(function(){var a,b;if(window.location.hostname==='localhost')return;a=document.createElement("script"),a.async=!0,a.src="https://hm.baidu.com/hm.js?05cbf3784f8cd2db4b54d582060e8a18",b=document.getElementsByTagName("script")[0],b.parentNode.insertBefore(a,b)})()</script>
</body>
</html>